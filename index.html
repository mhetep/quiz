<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Memory Mania</title>
<style>
    body {
        font-family: sans-serif;
        text-align: center;
        background-color: #f2e5cc;
    }
    .game-container {
        display: grid;
        grid-template-columns: repeat(4, 120px);
        grid-gap: 15px;
        justify-content: center;
        margin-top: 20px;
    }
    .card {
        width: 120px;
        height: 180px;
        background: url('MemoryManiaFront.png') center/cover;
        border: 2px solid #333;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .reset-button, .music-toggle {
        margin-top: 20px;
        padding: 12px 24px;
        font-size: 18px;
        cursor: pointer;
        border: none;
        border-radius: 10px;
        color: white;
        background: linear-gradient(45deg, #ff5733, #ffbd33);
        box-shadow: 2px 2px 10px rgba(0,0,0,0.3);
        transition: transform 0.2s;
    }
    .reset-button:hover, .music-toggle:hover {
        transform: scale(1.1);
    }
    .timer {
        font-size: 30px;
        font-weight: bold;
        background: black;
        color: white;
        padding: 10px 20px;
        border-radius: 10px;
        display: inline-block;
        margin-top: 10px;
    }
    .win-message {
        display: none;
        font-size: 40px;
        color: green;
        font-weight: bold;
        margin-top: 20px;
    }
    .fireworks {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: none;
    }
    .top-score {
        position: absolute;
        top: 10px;
        right: 10px;
        font-size: 24px;
        font-weight: bold;
        background: gold;
        padding: 10px;
        border-radius: 10px;
    }
</style>
</head>
<body>
<h1>Memory Card Game</h1>
<div class="top-score" id="topScore">Top Score: 0s</div>
<div class="timer" id="timer">Time: 0s</div>
<div class="game-container" id="gameBoard"></div>
<button class="reset-button" onclick="resetGame()">Reset Game</button>
<button class="music-toggle" onclick="toggleMusic()">Toggle Music</button>
<div class="win-message" id="winMessage">YOU WIN!</div>
<canvas class="fireworks" id="fireworksCanvas"></canvas>
<audio id="flipSound" src="FlipSound.wav" preload="auto"></audio>
<audio id="backgroundMusic" src="Nemui.wav" preload="auto" loop></audio>
<script>
    let flippedCards = [];
    let matchedCards = [];
    let timer = 0;
    let timerInterval;
    let musicStarted = false;
    let musicPlaying = true;
    let topScore = localStorage.getItem("topScore") || Infinity;

    function startTimer() {
        timer = 0;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timer++;
            document.getElementById("timer").innerText = `Time: ${timer}s`;
        }, 1000);
    }

    function toggleMusic() {
        let music = document.getElementById("backgroundMusic");
        musicPlaying ? music.pause() : music.play();
        musicPlaying = !musicPlaying;
    }

    function createBoard() {
        const gameBoard = document.getElementById("gameBoard");
        gameBoard.innerHTML = "";
        shuffledCards = shuffle([...cardsArray]);
        shuffledCards.forEach((cardData) => {
            let card = document.createElement("div");
            card.classList.add("card");
            card.dataset.name = cardData.name;
            card.style.backgroundImage = "url('MemoryManiaFront.png')";
            card.onclick = () => flipCard(card, cardData.img);
            gameBoard.appendChild(card);
        });
        startTimer();
    }

    function flipCard(card, imgSrc) {
        if (!musicStarted) {
            let music = document.getElementById("backgroundMusic");
            music.volume = 0.3;
            music.play();
            musicStarted = true;
        }
        if (flippedCards.length < 2 && !flippedCards.includes(card) && !matchedCards.includes(card)) {
            document.getElementById("flipSound").play();
            card.style.backgroundImage = `url('${imgSrc}')`;
            flippedCards.push(card);
            if (flippedCards.length === 2) {
                setTimeout(checkMatch, 800);
            }
        }
    }

    function checkMatch() {
        if (flippedCards[0].dataset.name === flippedCards[1].dataset.name) {
            matchedCards.push(...flippedCards);
        } else {
            flippedCards.forEach(card => {
                card.style.backgroundImage = "url('MemoryManiaFront.png')";
            });
        }
        flippedCards = [];
        if (matchedCards.length === cardsArray.length) {
            clearInterval(timerInterval);
            if (timer < topScore) {
                topScore = timer;
                localStorage.setItem("topScore", topScore);
                document.getElementById("topScore").innerText = `Top Score: ${topScore}s`;
            }
            celebrateWin();
        }
    }

    function celebrateWin() {
        document.getElementById("winMessage").style.display = "block";
        document.getElementById("fireworksCanvas").style.display = "block";
    }

    function resetGame() {
        flippedCards = [];
        matchedCards = [];
        document.getElementById("winMessage").style.display = "none";
        document.getElementById("fireworksCanvas").style.display = "none";
        createBoard();
    }

    function shuffle(array) {
        return array.sort(() => Math.random() - 0.5);
    }

    const cardsArray = [...Array(12)].map((_, i) => ({ name: `Card${i}`, img: `Card${i}.png` }));
    createBoard();
</script>
</body>
</html>
